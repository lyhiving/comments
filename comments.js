!function(a){var i,j,k,l,b=!1,c=null,d={$el:null,commentsById:{},hotCommentsById:{},commentsByIdSort:[],hotCommentsByIdSort:[],childCommentsById:{},usersById:{},currentSortKey:"",currentPageNum:0,currentTotalNum:0,doc_id:0,options:{profilePictureURL:"",usercenterURL:"http://127.0.0.1/views/userCenter.html",spinnerIconURL:"",upvoteIconURL:"",replyIconURL:"",noCommentsIconURL:"",textareaPlaceholderText:"说点什么吧...",popularText:"最热",newestText:"最新",oldestText:"最早",sendText:"发布",replyText:"回复",editText:"删除",editedText:"Edited",youText:"You",saveText:"保存",deleteText:"删除",viewAllRepliesText:"还有 __replyCount__ 条评论",hideRepliesText:"隐藏回复",noCommentsText:"没有评论",jubaoText:"举报",shareText:"分享",seesubText:"查看热门回复",textFormatter:function(a){return a},enableReplying:!0,enableEditing:!1,enableUpvoting:!0,enableDeleting:!1,enableDeletingCommentWithReplies:!0,highlightColor:"#337AB7",deleteButtonColor:"#C9302C",roundProfilePictures:!1,textareaRows:3,textareaRowsOnFocus:3,textareaMaxRows:10,maxRepliesVisible:2,pageSize:50,imageurl:"http://tp2.sinaimg.cn/",fieldMappings:{id:"id",parent:"parent",created:"created",content:"content",fullname:"fullname",authid:"authid",profilePictureURL:"profile",me:"me",upvoteCount:"upvote_count",downvoteCount:"downvote_count",userHasUpvoted:"user_has_upvoted",userHasDownvoted:"user_has_downvoted",uperParent:"upers",hotChild:"children",doc_id:"doc_id"},userFieldMappings:{id:"id",name:"name",profile:"profile",commentnum:"commentnum",watchingnum:"watchingnum",watchednum:"watchednum",gender:"gender",desc:"userdesc",iswatched:"iswatched",me:"me"},getComments:function(a){a([])},getCommentsByPage:function(a,b,c,d){d([])},watchDone:function(a,b,c){c([])},getCommentsNum:function(a,b){b([])},postComment:function(a,b){b(a)},putComment:function(a,b){b(a)},deleteComment:function(a,b){b()},upvoteComment:function(a,b){b(a)},downvoteComment:function(a,b){b(a)},jubaoComment:function(a,b){b(a)},isUserSigned:function(){},refresh:function(){},timeFormatter:function(a){return a}},events:{"keydown [contenteditable]":"saveOnKeydown","focus [contenteditable]":"saveEditableContent","keyup [contenteditable]":"checkEditableContentForChange","paste [contenteditable]":"checkEditableContentForChange","input [contenteditable]":"checkEditableContentForChange","blur [contenteditable]":"checkEditableContentForChange","click .navigation li:not(.countbox)":"navigationElementClicked","click .commenting-field.main .textarea":"showMainCommentingField","click .commenting-field.main .close":"hideMainCommentingField","click .commenting-field .textarea":"increaseTextareaHeight","change .commenting-field .textarea":"increaseTextareaHeight textareaContentChanged","click .commenting-field:not(.main) .close":"removeCommentingField","click .commenting-field .send.enabled":"postComment","click .commenting-field .delete.enabled":"deleteComment","click li.comment ul.child-comments .toggle-all":"toggleReplies","click li.comment button.reply":"replyButtonClicked","click li.comment button.seesub":"seesubButtonClicked","click li.comment button.edit":"editButtonClicked","click li.comment button.upvote":"upvoteComment","click li.comment button.downvote":"downvoteComment","click li.comment button.jubao":"jubaoComment","click .commenting-field .qqface":"qqfaceClicked","hover ul img.profile-picture, li.comment div.namebar div.name":"profileViewShowAndHide","hover .child-comments li.comment, .hotChild li.comment":"actionShowAndHide","hover li.comment button.share":"shareShowAndHide"},init:function(b,c){var d,e,f;this.$el=a(c),this.$el.addClass("gcomments"),this.undelegateEvents(),this.delegateEvents(),b.fieldMappings&&(b=a.extend({},b),a.extend(this.options.fieldMappings,b.fieldMappings),delete b["fieldMappings"]),a.extend(this.options,b),this.createCssDeclarations(),this.fetchDataAndRender(),d=this,d.doc_id=d.$el.attr("doc-id"),e=function(b){var c=a("<div/>",{id:"pager"});d.$el.after(c),c.hide(),d.currentTotalNum=b.count,c.pagination(d.currentTotalNum,{callback:d.pageChanged,items_per_page:d.options.pageSize},d)},f=function(){},this.options.getCommentsNum(d.doc_id,e,f)},refreshComments:function(){var b,c,d;this.createCssDeclarations(),this.fetchDataAndRender(),b=this,b.doc_id=b.$el.attr("doc-id"),c=function(c){a("#pager").remove();var d=a("<div/>",{id:"pager"});b.$el.after(d),d.hide(),b.currentTotalNum=c.count,d.pagination(b.currentTotalNum,{callback:b.pageChanged,items_per_page:b.options.pageSize},b)},d=function(){},this.options.getCommentsNum(b.doc_id,c,d)},pageChanged:function(a,b,c){return c.freshDataAndRender(a),!1},delegateEvents:function(){this.bindEvents(!1)},undelegateEvents:function(){this.bindEvents(!0)},bindEvents:function(b){var d,e,f,g,h,i,c=b?"off":"on";for(d in this.events)if(e=d.split(" ")[0],f=d.split(" ").slice(1).join(" "),g=this.events[d].split(" "),"hover"!=e)for(h in g)"map"!=h&&(i=this[g[h]],i=a.proxy(i,this),""==f?this.$el[c](e,i):this.$el[c](e,f,i));else i=this[g[0]],i=a.proxy(i,this),b?""==f?(this.$el[c]("mouseenter",i),this.$el[c]("mouseleave",i)):(this.$el[c]("mouseenter",f,i),this.$el[c]("mouseleave",f,i)):""==f?this.$el[c]("mouseenter mouseleave",i):this.$el[c]("mouseenter mouseleave",f,i)},fetchDataAndRender:function(){var c,d,b=this;b.doc_id=b.$el.attr("doc-id"),this.$el.empty(),this.commentsById={},this.childCommentsById={},this.hotCommentsById={},this.usersById={},this.commentsByIdSort=[],this.hotCommentsByIdSort=[],c=function(c){var d,e,f,g,h,i,j,k,l,m;void 0!=c.disableReply&&1==c.disableReply&&(b.options.enableReplying=!1),void 0!=c.authitems&&(d=c.authitems,e=d.map(function(a){return b.createUserModel(a)}),a(e).each(function(a,c){b.addUserToDataModel(c)})),f=c.items,b.currentTotalNum=c.count,g=f.map(function(a){return b.createCommentModel(a)}),a(g).each(function(a,c){b.addCommentToDataModel(c),b.commentsByIdSort.push(c.id)}),void 0!=c.uperitems&&(h=c.uperitems,i=h.map(function(a){return b.createCommentModel(a,1)}),a(i).each(function(a,c){b.addCommentToDataModel(c)})),void 0!=c.subitems&&(j=c.subitems,k=j.map(function(a){return b.createChildCommentModel(a)}),a(k).each(function(a,c){b.addCommentToChildDataModel(c)})),void 0!=c.hotitems&&(l=c.hotitems,m=l.map(function(a){return b.createCommentModel(a)}),a(m).each(function(a,c){b.addCommentToHotDataModel(c),b.hotCommentsByIdSort.push(c.id)})),b.createHTML(),b.render()},d=function(){c([])},this.options.getCommentsByPage(b.doc_id,this.currentPageNum,this.currentSortKey,c,d)},freshDataAndRender:function(b){var d,e,c=this;c.doc_id=c.$el.attr("doc-id"),this.commentsById={},this.childCommentsById={},this.commentsByIdSort=[],this.hotCommentsByIdSort=[],this.usersById={},this.currentPageNum=b,d=function(b){var d,e,f,g,h,i,j,k;void 0!=b.authitems&&(d=b.authitems,e=d.map(function(a){return c.createUserModel(a)}),a(e).each(function(a,b){c.addUserToDataModel(b)})),f=b.items,c.currentTotalNum=b.count,g=f.map(function(a){return c.createCommentModel(a)}),a(g).each(function(a,b){c.addCommentToDataModel(b),c.commentsByIdSort.push(b.id)}),void 0!=b.uperitems&&(h=b.uperitems,i=h.map(function(a){return c.createCommentModel(a,1)}),a(i).each(function(a,b){c.addCommentToDataModel(b)})),void 0!=b.subitems&&(j=b.subitems,k=j.map(function(a){return c.createChildCommentModel(a)}),a(k).each(function(a,b){c.addCommentToChildDataModel(b),c.hotCommentsByIdSort.push(b.id)})),c.render()},e=function(){d([])},this.options.getCommentsByPage(c.doc_id,this.currentPageNum,this.currentSortKey,d,e)},createCommentModel:function(a){var c,d,b=this.applyInternalMappings(a);return b.childs=[],b.upers=[],c="undefined"==typeof arguments[1]?0:arguments[1],b.level=c,d=this.usersById[b.authid],void 0!=d&&(b.fullname=d.name,b.profilePictureURL=d.profile),b},createChildCommentModel:function(a){var b=this.applyInternalMappings(a),c=this.usersById[b.authid];return void 0!=c&&(b.fullname=c.name,b.profilePictureURL=c.profile),b},createUserModel:function(a){var b=this.applyInternalUserMappings(a);return b},addCommentToDataModel:function(a){a.id in this.commentsById||(this.commentsById[a.id]=a,0==a.parent&&(a.parent=void 0))},addUserToDataModel:function(a){a.id in this.usersById||(this.usersById[a.id]=a)},addCommentToChildDataModel:function(a){a.id in this.childCommentsById||(this.childCommentsById[a.id]=a,0==a.parent&&(a.parent=void 0))},addCommentToHotDataModel:function(a){a.id in this.hotCommentsById||(this.hotCommentsById[a.id]=a,0==a.parent&&(a.parent=void 0))},updateCommentModel:function(b){a.extend(this.commentsById[b.id],b)},render:function(){var c,d,b=this;this.$el.find("#comment-list").remove(),c=a("<ul/>",{id:"comment-list"}).addClass("cmtlist"),this.currentSortKey=this.$el.find(".navigation li.active").data().sortKey,d=[],a(this.getComments()).each(function(a,b){0==b.level&&d.push(b)}),d.reverse(),a(d).each(function(a,d){b.addCommentByLevel(d,c)}),this.$el.find("> .spinner").remove(),this.$el.find(".no-comments").before(c),this.$el.parent().find("#pager").show(),this.options.refresh()},addComment:function(a,b){var c,d,e,f;b=b||this.$el.find("#comment-list"),c=this.createCommentElement(a),a.parent?(d=b.find('.comment[data-id="'+a.parent+'"]'),e=d.parents(".comment").last(),0==e.length&&(e=d),f=e.find(".child-comments"),f.append(c),this.updateToggleAllButton(e)):b.prepend(c)},addCommentByLevel:function(b,c){var d,e,f,g,h,i,j,k,l;if(c=c||this.$el.find("#comment-list"),void 0!=b.uperParent&&b.uperParent.length>0){d=b.uperParent.split(",");for(e in d)f=this.commentsById[d[e]],void 0!=f&&b.upers.push(f)}for(g=this.createCommentElement(b),c.prepend(g),h=b.upers.length,i=0;h>0;)j=g.find(".child-comments"),i++,k=this.createCommentElement(b.upers[h-1],!0),l=a("<floor/>",{text:h+"楼"}),k.children(".comment-wrapper").find("time").before(l),k.find(".actions").addClass("hidden-act"),j.prepend(k),h--;this.updateToggleAllButton(g)},removeComment:function(a){var d,e;this.commentsById[a],delete this.commentsById[a],d=this.$el.find('li.comment[data-id="'+a+'"]'),e=d.parents("li.comment").last(),d.remove(),this.updateToggleAllButton(e)},updateToggleAllButton:function(b){var f,g,h,c=b.find(".child-comments"),d=c.children(".comment"),e=c.find("li.toggle-all");d.removeClass("hidden-reply"),f=d.slice(1,-1),f.addClass("hidden-reply"),e.find("span.text").text()==this.options.textFormatter(this.options.hideRepliesText)&&f.addClass("visible"),d.length>this.options.maxRepliesVisible?(e.length||(e=a("<li/>").addClass("toggle-all highlight-font-bold"),g=a("<span/>").addClass("text"),h=a("<span/>").addClass("caret"),e.append(g).append(h),d.eq(0).after(e)),this.setToggleAllButtonText(e,!1)):e.remove()},sortComments:function(a,b){var c=this;"popularity"==b?a.sort(function(a,b){var f,g,d=a.childs.length,e=b.childs.length;return c.options.enableUpvoting&&(d+=a.upvoteCount,e+=b.upvoteCount),e!=d?e-d:(f=new Date(a.created).getTime(),g=new Date(b.created).getTime(),g-f)}):a.sort(function(a,c){var d=new Date(a.created).getTime(),e=new Date(c.created).getTime();return"newest"==b?e-d:d-e})},sortAndReArrangeComments:function(b){var c=this.$el.find("#comment-list"),d=this.getComments();this.sortComments(d,b),a(d).each(function(a,b){var d=c.find("> li.comment[data-id="+b.id+"]");c.append(d)})},saveOnKeydown:function(b){if(13==b.keyCode&&(b.metaKey||b.ctrlKey)){var c=a(b.currentTarget);c.siblings(".control-row").find(".save").trigger("click"),b.stopPropagation(),b.preventDefault()}},saveEditableContent:function(b){var c=a(b.currentTarget);c.data("before",c.html())},checkEditableContentForChange:function(b){var c=a(b.currentTarget);c.data("before")!=c.html()&&(c.data("before",c.html()),c.trigger("change"))},navigationElementClicked:function(b){var d,e,c=a(b.currentTarget);c.siblings().removeClass("active"),c.addClass("active"),d=c.data().sortKey,this.currentSortKey=d,e=a("#pager"),e.find(".pagination").length>0?(e.data("current_page",-1),a("#pager div").children(":first").trigger("click")):this.freshDataAndRender(-1)},showMainCommentingField:function(b){var c=a(b.currentTarget);c.siblings(".control-row").show(),c.parent().find(".close").show(),c.focus()},hideMainCommentingField:function(b){var c=a(b.currentTarget),d=this.$el.find(".commenting-field.main .textarea");this.$el.find(".commenting-field.main .control-row"),this.clearTextarea(d),this.adjustTextareaHeight(d,!1,!0),c.hide(),d.blur()},increaseTextareaHeight:function(b){var c=a(b.currentTarget);this.adjustTextareaHeight(c,!0)},textareaContentChanged:function(b){var g,h,j,k,l,c=a(b.currentTarget),d=this.getTextareaContent(c),e=c.siblings(".control-row").find(".save"),f=c.parents(".commenting-field").first();c[0].scrollHeight>c.outerHeight()?f.addClass("scrollable"):f.removeClass("scrollable"),g=!0,h=c.attr("data-comment"),h&&(j=d!=this.commentsById[h].content,this.commentsById[h].parent&&(k=this.commentsById[h].parent.toString()),l=c.attr("data-parent")!=k,g=j||l),d.length&&g?e.addClass("enabled"):e.removeClass("enabled"),c.parents(".replybox").length||i&&localStorage.setItem("_cmt.reply",d)},removeCommentingField:function(b){var e,f,c=a(b.currentTarget),d=c.siblings(".textarea");d.attr("data-comment")&&c.parents("li.comment").first().removeClass("edit"),e=c.parents(".commenting-field").first(),f=e.parents(".hotChild"),0==f.length&&(f=e.parents(".child-comments")),f.length>0&&f.first().find(".actions").addClass("hidden-act"),e.remove()},postComment:function(b){var c,d,e,f,g,j,k,l;if(this.isUserSigned()){if(c=this,d=a(b.currentTarget),e=d.parents(".commenting-field").first(),f=e.find(".textarea"),g=this.getTextareaContent(f),g.length>3e3)return alert("不能超过3000字"),void 0;d.parent(),d.removeClass("enabled"),j={parent:f.attr("data-parent")||null,content:g,me:!0,upvoteCount:0,downvoteCount:0,userHasUpvoted:!1,userHasDownvoted:!1,doc_id:c.doc_id},j=this.applyExternalMappings(j),k=function(a){var d,f,b=c.createCommentModel(a);if(c.addCommentToDataModel(b),c.addCommentByLevel(b),e.find(".close").trigger("click"),i)for(d=0;d<localStorage.length;d++)f=localStorage.key(d),0==f.indexOf("_cmt.")&&localStorage.removeItem(f);c.$el.find(".navigation .countbox span").text(++c.currentTotalNum),c.usersById[b.authid].commentnum++},l=function(a){d.addClass("enabled"),"-2"==a.code?c.loginPopupRemote():"2"==a.code&&alert(a.result)},this.options.postComment(j,k,l)}},loginPopupRemote:function(){var b=a("#GlobalLoginButton");b&&b.trigger("click")},loginPopup:function(){},putComment:function(b){var h,i,j,c=this,d=a(b.currentTarget),e=d.parents(".commenting-field").first(),f=e.find(".textarea"),g=this.getTextareaContent(f);d.removeClass("enabled"),h=a.extend({},this.commentsById[f.attr("data-comment")]),a.extend(h,{parent:f.attr("data-parent")||null,content:g,modified:(new Date).getTime()}),h=this.applyExternalMappings(h),i=function(a){var b=c.createCommentModel(a);delete b["childs"],c.updateCommentModel(b),e.find(".close").trigger("click"),c.reRenderComment(b.id)},j=function(){d.addClass("enabled")},this.options.putComment(h,i,j)},deleteComment:function(b){var h,i,c=this,d=a(b.currentTarget),e=d.parents(".commenting-field").first().find(".textarea"),f=a.extend({},this.commentsById[e.attr("data-comment")]),g=f.id;d.removeClass("enabled"),f=this.applyExternalMappings(f),h=function(){c.removeComment(g)},i=function(){d.addClass("enabled")},this.options.deleteComment(f,h,i)},toggleReplies:function(b){var c=a(b.currentTarget);c.siblings(".hidden-reply").toggleClass("visible"),this.setToggleAllButtonText(c,!0)},seesubButtonClicked:function(b){var c=a(b.currentTarget),d=c.parents(".comment").first().find(".hotChild");d.children().toggleClass("visible")},replyButtonClicked:function(b){var i,j,c=a(b.currentTarget),d=c.parents("li.comment").first().data().id,e=a(".cmtlist"),f=e.find(".replybox > .commenting-field"),g=f.parents(".comment").first().attr("data-id"),h=null;if(f.length&&(i=f.parents(".hotChild"),0==i.length&&(i=f.parents(".child-comments")),i.length>0&&(h=i.first()),f.remove()),g!=d){if(!this.isUserSigned())return;f=this.createCommentingFieldElement(d),i=c.parents(".comment").first(),i.children(".replybox").append(f),null!=h&&h.find(".actions").addClass("hidden-act"),i.children(".comment-wrapper").first().find(".actions").removeClass("hidden-act"),j=f.find(".textarea"),this.moveCursorToEnd(j)}},isUserSigned:function(){return this.options.isUserSigned()?!0:(this.loginPopupRemote(),!1)},editButtonClicked:function(b){var c,d,e,f,g,h,i;confirm("确定要删除评论吗？")&&(c=a(b.currentTarget),d=c.parents("li.comment").first(),e=this,f=a.extend({},this.commentsById[d.attr("data-id")]),g=f.id,f=this.applyExternalMappings(f),h=function(){e.removeComment(g),e.$el.find(".navigation .countbox span").text(--e.currentTotalNum)},i=function(){},this.options.deleteComment(f,h,i))},qqfaceClicked:function(b){a("#emotion").is(":visible")||(a(b.currentTarget).emotion(),b.stopPropagation())},profileViewShowAndHide:function(a){"mouseenter"==a.type?this.profileViewShow(a):"mouseleave"==a.type&&this.profileViewHide(a)},actionShowAndHide:function(a){"mouseenter"==a.type?this.actionShow(a):"mouseleave"==a.type&&this.actionHide(a)},shareShowAndHide:function(a){"mouseenter"==a.type?this.shareComment(a):"mouseleave"==a.type&&this.profileViewHide(a)},profileViewShow:function(d){var e=this,f=a(d.currentTarget),g=f.parents(".comment").first().find(".namebar").attr("uid");c=setTimeout(function(){var d,h,i,j,k,l,m,n,o,p,q,r;c=0,b=!0,d=e.usersById[g],h=void 0!=d.profile&&""!=d.profile?"http:"!=d.profile.substr(0,5)?e.options.imageurl+d.profile:d.profile:e.options.profilePictureURL,i=void 0!=d.gender&&0!=d.gender?d.gender:"0",j=void 0!=d.commentnum?d.commentnum:0,k=void 0!=d.watchingnum?d.watchingnum:0,l=void 0!=d.watchednum?d.watchednum:0,m=void 0!=d.me?d.me:!1,n=void 0!=d.iswatched?d.iswatched:!1,o=void 0!=d.desc&&0!=d.desc?d.desc:"<br/>",p=d.name,null!=p&&p.length>7&&(p=p.substr(0,7)+"<br>"+p.substr(7)),q="<a href='##'><i class='icon-watch"+(n?"ed":"")+"'></i></a><a href='##'><i class='icon-msg' recid='"+g+"'></i></a>",r="<div class='pcard'><div class='upper'><a href='##'><img src='"+h+"'></img><span class='pn'>"+p+"</span></a><i class='icon-gender-"+i+"'></i><div class='opers'>"+(m?"":q)+"</div><div class='tagline'>"+o+"</div></div><div class='lower'><a href='#'><span class='l-key'>评论过</span><span class='l-value'>"+j+"条</span></a><a href='#'><span class='l-key'>称赞过</span><span class='l-value'>"+k+"人</span></a><a href='#' class='p-last'><span class='l-key'>被赞过</span><span class='l-value'>"+l+"次</span></a></div></div>",a.pt({width:280,height:160,target:f,content:r}),a(".pcard .upper a ").unbind("click").click(function(b){var c=a(b.currentTarget);c.attr("class"),window.open(e.options.usercenterURL+"?id="+g),b.preventDefault(),b.stopPropagation()}),a(".pcard .opers a i").unbind("click").click(function(b){var i,j,c=a(b.currentTarget),d=c.attr("class"),f=function(){0==j?(c.removeClass("icon-watched").addClass("icon-watch"),e.usersById[g].iswatched="0"):(c.removeClass("icon-watch").addClass("icon-watched"),e.usersById[g].iswatched="1")},h=function(a){"-2"==a.code&&e.loginPopupRemote()};e.isUserSigned()&&("icon-msg"==d?(i=c.parents(".upper").first().find(".pn").text(),e.sendMessage(c.attr("recid"),i)):(j="icon-watch"==d?1:0,e.options.watchDone(j,g,f,h))),b.preventDefault(),b.stopPropagation()})},500),d.stopPropagation()},sendMessage:function(b,c){var d=a("#GlobalMsgButton");d&&(d.attr("uid",b).attr("uname",c),d.trigger("click",[b,c]))},profileViewHide:function(a){return c?(clearTimeout(c),c=0,void 0):(b=!1,a.stopPropagation(),void 0)},actionShow:function(b){var c=a(b.currentTarget);c.children(".comment-wrapper").first().find(".actions").removeClass("hidden-act"),b.stopPropagation()},actionHide:function(b){var c=a(b.currentTarget),d=c.find(".commenting-field").first();0==d.length&&c.find(".actions").addClass("hidden-act"),b.stopPropagation()},upvoteComment:function(b){var c,d,f,g,h,i,j,k,l,m,n,o;this.isUserSigned()&&(c=this,d=a(b.currentTarget).parents("li.comment").first(),a(b.currentTarget).parents(".wrapper").first(),f=d.attr("data-id"),g=d.parent(),h=g.attr("class"),i="","child-comments"==h?(g=g.parent(),i=g.attr("data-id")):g=d,j=this.commentsById[f],void 0==j&&(j=this.childCommentsById[f]),void 0==j&&(j=this.hotCommentsById[f]),k=j.upvoteCount,l=j.userHasUpvoted?k-1:k+1,j.userHasUpvoted=!j.userHasUpvoted,j.upvoteCount=l,this.reRenderUpvotes(j.id,i),m=a.extend({},j),m=this.applyExternalMappings(m),n=function(){},o=function(a){j.userHasUpvoted=!j.userHasUpvoted,j.upvoteCount=k,c.reRenderUpvotes(j.id),"-2"==a.code&&c.loginPopupRemote()},this.options.upvoteComment(m,n,o))},downvoteComment:function(b){var c,d,f,g,h,i,j,k,l,m,n,o;this.isUserSigned()&&(c=this,d=a(b.currentTarget).parents("li.comment").first(),a(b.currentTarget).parent(),f=d.attr("data-id"),g=d.parent(),h=g.attr("class"),i="","child-comments"==h?(g=g.parent(),i=g.attr("data-id")):g=d,j=this.commentsById[f],void 0==j&&(j=this.childCommentsById[f]),void 0==j&&(j=this.hotCommentsById[f]),k=j.downvoteCount,l=j.userHasDownvoted?k-1:k+1,j.userHasDownvoted=!j.userHasDownvoted,j.downvoteCount=l,this.reRenderDownvotes(j.id,i),m=a.extend({},j),m=this.applyExternalMappings(m),n=function(){},o=function(a){j.userHasDownvoted=!j.userHasDownvoted,j.downvoteCount=k,c.reRenderDownvotes(j.id),"-2"==a.code&&c.loginPopupRemote()},this.options.downvoteComment(m,n,o))},jubaoComment:function(b){var c=this,d=a(b.currentTarget).parents("li.comment").first(),e={id:d.attr("data-id"),doc_id:c.doc_id},f=function(){window.alert("感谢您的反馈")},g=function(){},h=window.confirm("确定举报这条评论吗？");h&&this.options.jubaoComment(e,f,g)},shareComment:function(c){var d=a(c.currentTarget).parent().prev().text(),e=a(c.currentTarget);b=!0,a.pt({target:e,content:"<ul class='sharebar'><li><a class='sina-share' href='javascript:void(0)'><span class='icon-sina'></span></a></li><li><a class='qq-share' href='javascript:void(0)'><span class='icon-qq'></span></a></li></ul>",width:70,height:28,arrow:!1,autoClose:!0,leaveClose:!0}),a(".sharebar li a").unbind("click").click(function(b){var e,f,g,h,i,j,c=a(b.currentTarget).attr("class");if(a(".pt").hide(),e="height=400,width=800,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no","sina-share"==c){f={},f.url=window.location.href,f.title=d+" #观察者网#",f.appkey="9556eaf5e82bd4a0bf390ab8cda52e6a",g=[];for(h in f)g.push(h+"="+encodeURIComponent(f[h]||""));i=g.join("&"),j="http://service.weibo.com/share/share.php?"+i,window.open(j,"_blank",e)}else if("qq-share"==c){f={},f.url=window.location.href,f.title="观察者网",f.desc=d,f.appkey="032059e965e771f7c34524f9dc4a04a1",g=[];for(h in f)g.push(h+"="+encodeURIComponent(f[h]||""));i=g.join("&"),j="http://connect.qq.com/widget/shareqq/index.html?"+i,window.open(j,"_blank",e)}}),c.stopPropagation()},createHTML:function(){var d,e,f,h,j,k,b=this,c=this.createHotlistElement();c.addClass("cmtlist"),this.$el.append(c),d=this.createCommentingFieldElement(),d.addClass("main"),i&&(e=localStorage.getItem("_cmt.reply"),null!=e&&e.length>0&&(d.find(".textarea").html(e),f=d.find(".control-row").find(".save"),f.addClass("enabled"))),b.options.enableReplying&&this.$el.append(d),d.find(".control-row"),d.find(".close").hide(),this.$el.append(this.createNavigationElement()),h=a("<div/>").addClass("spinner"),j=a("<i/>").addClass("fa fa-spinner fa-spin"),this.options.spinnerIconURL.length&&(j.css("background-image",'url("'+this.options.spinnerIconURL+'")'),j.addClass("image")),h.html(j),this.$el.append(h),k=a("<div/>").addClass("no-comments"),k.hide(),this.$el.append(k)},createProfilePictureElement:function(b){var c=a("<img/>",{src:b}).addClass("profile-picture"+(this.options.roundProfilePictures?" round":""));return c},createHotlistElement:function(){var b=this,c=a("<ul/>",{id:"hot-list"}),d=[];return a(this.getHotComments()).each(function(a,b){d.push(b)}),d.reverse(),a(d).each(function(a,d){b.addCommentByLevel(d,c)}),d.length>0&&c.prepend(a("<div/>",{text:"热门评论"}).addClass("hotlist-header")),c},createCommentingFieldElement:function(b,c){var g,i,j,k,l,m,n,o,p,q,r,e=a("<div/>").addClass("commenting-field"),f=this.createProfilePictureElement(this.options.profilePictureURL);return f.addClass("by-current-user"),g=a("<div/>").addClass("textarea-wrapper"),i=a("<div/>").addClass("control-row"),j=a("<div/>",{"data-placeholder":this.options.textFormatter(this.options.textareaPlaceholderText),contenteditable:!0}).addClass("textarea"),this.adjustTextareaHeight(j,!1,!0),k=a("<span/>").addClass("close"),c?(l=this.options.textFormatter(this.options.saveText),this.options.enableDeleting&&(m=!0,this.options.enableDeletingCommentWithReplies||a(this.getComments()).each(function(a,b){b.parent==c&&(m=!1)}),m&&(n=a("<span/>",{text:this.options.textFormatter(this.options.deleteText)}).addClass("enabled delete").css("background-color",this.options.deleteButtonColor),i.append(n)))):l=this.options.textFormatter(this.options.sendText),o=a("<span/>").addClass("qqface  enabled"),p=a("<span/>").addClass("markbold enabled"),q=c?"update":"send",r=a("<span/>",{text:l}).addClass(q+" save highlight-background"),i.prepend(p).prepend(o).prepend(r),g.append(k).append(j).append(i),e.append(f).append(g),b&&j.attr("data-parent",b),j.markbold(),p.off("mousedown").on("mousedown",function(a){h["bold"].call(j,a),a.stopPropagation()}),f.on("mouseenter",function(a){return a.stopPropagation(),!1}),e},createNavigationElement:function(){var e,f,g,b=a("<ul/>").addClass("navigation"),c=a("<span/>",{text:this.currentTotalNum}),d=a("<li/>",{text:" 条评论"}).addClass("countbox");return d.prepend(c),e=a("<li/>",{text:this.options.textFormatter(this.options.newestText),"data-sort-key":"newest"}),f=a("<li/>",{text:this.options.textFormatter(this.options.oldestText),"data-sort-key":"oldest"}),g=a("<li/>",{text:this.options.textFormatter(this.options.popularText),"data-sort-key":"popularity"}),b.append(d),b.append(g).append(f),b.append(e),b.children().last().addClass("active"),b},createCommentElement:function(b,c,d){var f,g,h,i,j,k,l,m,n,e=a("<li/>",{"data-id":b.id}).addClass("comment");if(b.me&&e.addClass("by-current-user"),f=a("<ul/>").addClass("child-comments"),void 0==c&&void 0!=b.upers&&b.upers.length>0&&e.append(f),g=this.createCommentWrapperElement(b,c?void 0:e),e.append(g),h=a("<div/>").addClass("replybox"),e.append(h),void 0==d&&(d=!1),!d&&void 0!=b.hotChild&&b.hotChild.length>0){i=a("<button/>",{text:this.options.textFormatter(this.options.seesubText)}).addClass("action seesub"),g.find(".actions").append(i),j=a("<ul/>").addClass("hotChild"),k=b.hotChild.split(",");for(l in k)m=this.commentsById[k[l]],null==m&&(m=this.childCommentsById[k[l]]),null!=m&&(n=this.createCommentElement(m,!0,!0),n.addClass("hidden-reply"),n.find(".actions").addClass("hidden-act"),j.append(n));e.append(j)}return e},createCommentWrapperElement:function(b,c){var n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,d=a("<div/>").addClass("comment-wrapper"),e=this.createProfilePictureElement(void 0!=b.profilePictureURL&&""!=b.profilePictureURL?"http:"!=b.profilePictureURL.substr(0,5)?this.options.imageurl+b.profilePictureURL:b.profilePictureURL:this.options.profilePictureURL),f=a("<time/>",{}),g=b.created,h=g.split(" "),i=h[0].split("-"),j=h[1].split(":"),k=new Date(i[0],i[1]-1,i[2],j[0],j[1],j[2]),l=k.getTime()/1e3,m=(new Date).getTime()/1e3-l;return g=60>m?"刚刚":3600>m?parseInt(m/60)+"分钟前":86400>m?parseInt(m/3600)+"小时前":g.substr(0,10),void 0==c&&f.text(g),n=a("<div/>",{text:b.fullname}).addClass("name"),o=a("<div/>").addClass("namebar"),o.append(n),void 0==c&&o.append(f),o.attr("uid",b.authid),p=a("<div/>").addClass("wrapper"),q=b.content,r=a("<div/>",{text:b.content}).addClass("content").html(q),s=a("<button/>",{text:g}).addClass("timeago"),t=a("<span/>").addClass("actions"),a("<span/>",{text:"·"}).addClass("separator"),v=a("<i/>").addClass("re"),w=a("<button/>",{text:this.options.textFormatter(this.options.replyText)}).addClass("action reply").prepend(v),x=this.createUpvoteElement(b),y=this.createDownvoteElement(b),z=a("<i/>").addClass("ju"),A=a("<button/>",{text:this.options.textFormatter(this.options.jubaoText)}).addClass("action jubao").prepend(z),B=a("<i/>").addClass("zf"),C=a("<button/>",{text:this.options.textFormatter(this.options.shareText)}).addClass("action share").prepend(B),D=a("<button/>",{text:this.options.textFormatter(this.options.editText)}).addClass("action edit"),void 0!=c&&t.append(s),this.options.enableReplying&&t.append(w),t.append(x).append(y).append(A).append(C),this.options.enableEditing&&b.me&&t.append(D),p.append(r),p.append(t),void 0==c?d.append(e).append(o).append(p):(c.prepend(o).prepend(e),d.append(p)),d},createUpvoteElement:function(b){var c=a("<i/>").addClass("fa"),d=a("<button/>").addClass("action upvote"+(b.userHasUpvoted?" highlight-font":"")).append(c).append(a("<span/>",{text:"顶("+b.upvoteCount+")"}).addClass("upvote-count"));return d},createDownvoteElement:function(b){var c=a("<i/>").addClass("cai"),d=a("<button/>").addClass("action downvote"+(b.userHasDownvoted?" highlight-font":"")).append(c).append(a("<span/>",{text:"踩("+b.downvoteCount+")"}).addClass("downvote-count"));return d},reRenderComment:function(a){var b=this.commentsById[a],c=this.createCommentWrapperElement(b),d=this.$el.find('li.comment[data-id="'+b.id+'"]');d.find("> .comment-wrapper").replaceWith(c)},reRenderUpvotes:function(a){var d,e,c=this.commentsById[a];void 0==c&&(c=this.childCommentsById[a]),void 0==c&&(c=this.hotCommentsById[a]),d=this.createUpvoteElement(c),e=this.$el.find('li.comment[data-id="'+c.id+'"]').children(".comment-wrapper"),e.find(".upvote").replaceWith(d)},reRenderDownvotes:function(a){var d,e,c=this.commentsById[a];void 0==c&&(c=this.childCommentsById[a]),void 0==c&&(c=this.hotCommentsById[a]),d=this.createDownvoteElement(c),e=this.$el.find('li.comment[data-id="'+c.id+'"]').children(".comment-wrapper"),e.find(".downvote").replaceWith(d)},createCssDeclarations:function(){var b,a=document.getElementsByTagName("head")[0]||document.documentElement;"undefined"==typeof JSON&&(b=document.createElement("script"),b.src="js/json2.js",a.appendChild(b))},getComments:function(){var a=this;return this.commentsByIdSort.map(function(b){return a.commentsById[b]})},getHotComments:function(){var a=this;return this.hotCommentsByIdSort.map(function(b){return a.hotCommentsById[b]})},getChildComments:function(a){return this.getComments().filter(function(b){return b.parent==a})},getOutermostParent:function(a){var c,b=a;do c=this.commentsById[b],void 0==c&&(c=this.childCommentsById[b]),b=c.parent;while(null!=c.parent);return c},setToggleAllButtonText:function(a,b){var c=this,d=a.find("span.text"),e=a.find(".caret"),f=function(){var b=c.options.textFormatter(c.options.viewAllRepliesText),e=a.siblings(".comment").length;b=b.replace("__replyCount__",e-2),d.text(b)},g=this.options.textFormatter(this.options.hideRepliesText);b?(d.text()==g?f():a.remove(),e.toggleClass("up")):d.text()!=g&&f()},adjustTextareaHeight:function(a,b,c){var g,h,i,d=2.2,e=1.45,f=function(b){var c=d+(b-1)*e;a.css("height",c+"em")};if(c)f(this.options.textareaRowsOnFocus);else{g=1==b?this.options.textareaRowsOnFocus:this.options.textareaRows;do f(g),g++,h=a[0].scrollHeight>a.outerHeight(),i=0==this.options.textareaMaxRows?!1:g>this.options.textareaMaxRows;while(h&&!i)}},clearTextarea:function(a){a.empty().trigger("input")},getTextareaContent:function(b){var c={">":"&gt;","<":"&lt;"},d=a("<pre/>").html(b.html().replace(/<|>|'|"|&/g,function(a){return c[a]})),e="<b></b><strong></strong><br></br><p></p>",f=/<\/?([a-z][a-z0-9]*)[^>]*>/gi,g=d.text().replace(/<div>/gi,"<br>").replace(/<\/div>/gi,"</br>").replace(f,function(a,b){return e.indexOf("<"+b+">")>-1?a:""}).replace(/undefined/g,"&").replace(/<p [^>]+>/gi,"<p>");return g},moveCursorToEnd:function(b){var c,d,e;b=a(b)[0],a(b).scrollTop(b.scrollHeight),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange?(c=document.createRange(),c.selectNodeContents(b),c.collapse(!1),d=window.getSelection(),d.removeAllRanges(),d.addRange(c)):"undefined"!=typeof document.body.createTextRange&&(e=document.body.createTextRange(),e.moveToElementText(b),e.collapse(!1),e.select()),b.focus()
},escape:function(b){return a("<pre/>").text(b).html()},applyInternalMappings:function(a){var d,b={},c=this.options.fieldMappings;for(d in c)c.hasOwnProperty(d)&&(b[c[d]]=d);return this.applyMappings(b,a)},applyInternalUserMappings:function(a){var d,b={},c=this.options.userFieldMappings;for(d in c)c.hasOwnProperty(d)&&(b[c[d]]=d);return this.applyMappings(b,a)},applyExternalMappings:function(a){var b=this.options.fieldMappings;return this.applyMappings(b,a)},applyMappings:function(a,b){var d,e,c={};for(d in b)d in a&&(e=a[d],c[e]=b[d]);return c}},e={save:function(){if(window.getSelection){var a=window.getSelection();if(a.rangeCount>0)return a.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}},f={bindEvents:function(a){a.mouseup(g.mouseUp)}},g={mouseUp:function(){e.save()}},h={bold:function(a){a.preventDefault(),document.execCommand("bold",!1)}};a.fn.markbold=function(){return f.bindEvents(this),this},a.fn.comments=function(b){return this.each(function(){var c=Object.create(d);c.init(b||{},this),a.data(this,"comments",c)})},i="localStorage"in window&&null!==window["localStorage"],a.PaginationCalculator=function(a,b){this.maxentries=a,this.opts=b},a.extend(a.PaginationCalculator.prototype,{numPages:function(){return Math.ceil(this.maxentries/this.opts.items_per_page)},getInterval:function(a){var b=Math.floor(this.opts.num_display_entries/2),c=this.numPages(),d=c-this.opts.num_display_entries,e=a>b?Math.max(Math.min(a-b,d),0):0,f=a>b?Math.min(a+b+this.opts.num_display_entries%2,c):Math.min(this.opts.num_display_entries,c);return{start:e,end:f}}}),a.PaginationRenderers={},a.PaginationRenderers.defaultRenderer=function(b,c){this.maxentries=b,this.opts=c,this.pc=new a.PaginationCalculator(b,c)},a.extend(a.PaginationRenderers.defaultRenderer.prototype,{createLink:function(b,c,d){var e,f=this.pc.numPages();return b=0>b?0:f>b?b:f-1,d=a.extend({text:b+1,classes:""},d||{}),e=b==c?a("<a href='#' class='current'>"+d.text+"</a>"):a("<a>"+d.text+"</a>").attr("href",this.opts.link_to.replace(/__id__/,b)),d.classes&&e.addClass(d.classes),d.rel&&e.attr("rel",d.rel),e.data("page_id",b),e},appendRange:function(a,b,c,d,e){var f;for(f=c;d>f;f++)this.createLink(f,b,e).appendTo(a)},getLinks:function(b,c){var d,e,f=this.pc.getInterval(b),g=this.pc.numPages(),h=a("<div class='pagination'></div>");return f.start>0&&this.opts.num_edge_entries>0&&(e=Math.min(this.opts.num_edge_entries,f.start),this.appendRange(h,b,0,e,{classes:"sp"}),this.opts.num_edge_entries<f.start&&this.opts.ellipse_text&&a("<a>"+this.opts.ellipse_text+"</a>").appendTo(h)),this.appendRange(h,b,f.start,f.end),f.end<g&&this.opts.num_edge_entries>0&&(g-this.opts.num_edge_entries>f.end&&this.opts.ellipse_text&&a("<a>"+this.opts.ellipse_text+"</a>").appendTo(h),d=Math.max(g-this.opts.num_edge_entries,f.end),this.appendRange(h,b,d,g,{classes:"ep"})),a("a",h).click(c),h}}),a.fn.pagination=function(b,c,d){function i(b){var d=a(b.target).data("page_id"),e=j(d);return e||b.stopPropagation(),e}function j(a){if(e.data("current_page")==a)return!1;e.data("current_page",a),g=f.getLinks(a,i),e.empty(),g.appendTo(e);var b=c.callback(a,e,d);return b}var f,g,h,e,k,l;if(c=a.extend({items_per_page:5,num_display_entries:11,current_page:0,num_edge_entries:0,link_to:"#",ellipse_text:"...",renderer:"defaultRenderer",show_if_single_page:!1,load_first_page:!1,callback:function(){return!1}},c||{}),e=this,h=parseInt(c.current_page,10),e.data("current_page",h),b=!b||0>b?1:b,c.items_per_page=!c.items_per_page||c.items_per_page<0?1:c.items_per_page,!a.PaginationRenderers[c.renderer])throw new ReferenceError("Pagination renderer '"+c.renderer+"' was not found in jQuery.PaginationRenderers object.");f=new a.PaginationRenderers[c.renderer](b,c),k=new a.PaginationCalculator(b,c),l=k.numPages(),e.off("setPage").on("setPage",{numPages:l},function(a,b){return b>=0&&b<a.data.numPages&&j(b),!1}),e.off("prevPage").on("prevPage",function(){var c=a(this).data("current_page");return c>0&&j(c-1),!1}),e.off("nextPage").on("nextPage",{numPages:l},function(b){var c=a(this).data("current_page");return c<b.data.numPages-1&&j(c+1),!1}),e.off("currentPage").on("currentPage",function(){var b=a(this).data("current_page");return j(b),!1}),g=f.getLinks(h,i),e.empty(),(l>1||c.show_if_single_page)&&g.appendTo(e),c.load_first_page&&c.callback(h,e,d)},j={$target:null,options:{rows:60},emotions:null,categories:null,emotionsMap:{},parsingArray:[],defCategory:"默认",initEvents:function(){a("body").bind({click:function(){a("#emotion").hide()}});var b=this;a("#emotion").bind({click:function(a){a.stopPropagation()}}).delegate(".prev",{click:function(c){var d=a("#emotion .categories").data("page");b.showCatPage(d-1),c.preventDefault()}}).delegate(".next",{click:function(c){var d=a("#emotion .categories").data("page");b.showCatPage(d+1),c.preventDefault()}}).delegate(".category",{click:function(c){a("#emotion .categories .current").removeClass("current"),b.showCategory(a.trim(a(this).addClass("current").text())),c.preventDefault()}}).delegate(".page",{click:function(c){a("#emotion .pages .current").removeClass("current");var d=parseInt(a(this).addClass("current").text()-1);b.showFacePage(d),c.preventDefault()}}).delegate(".face",{click:function(c){a("#emotion").hide();var d=b.$target.parents(".textarea-wrapper").first().find(".textarea");d.append(a(this).children("img").prop("alt")),d.trigger("change"),c.preventDefault()}})},loadEmotions:function(b){if(this.emotions)return b&&b(),void 0;var c=this;a("body").append('<div id="emotion">正在加载，请稍后...</div>'),this.initEvents(),this.emotions={},a.getJSON("http://127.0.0.1/comment/emotions.json?callback=?",function(a){c.loadSucceed(a,b)})},loadSucceed:function(b,c){var d,e,g,h,f=b.data;for(a("#emotion").html('<div class="right"><a href="#" class="prev">&laquo;</a><a href="#" class="next">&raquo;</a></div><ul class="categories"></ul><ul class="faces"></ul><ul class="pages"></ul>'),this.categories=[],g=0,h=f.length;h>g;++g)d=f[g],e=d.category||this.defCategory,this.emotions[e]||(this.emotions[e]=[],this.categories.push(e)),this.emotions[e].push({icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+d.icon,phrase:d.phrase});c&&c()},showCatPage:function(b){var h,c="",d=this.categories.length,e=Math.ceil(d/5),f=a("#emotion .categories"),g=f.data("category")||this.defCategory;for(b=(b+e)%e,h=5*b;d>h&&5*(b+1)>h;++h)c+='<li class="item"><a href="#" class="category'+(g==this.categories[h]?" current":"")+'">'+this.categories[h]+"</a></li>";f.data("page",b).html(c)},showCategory:function(b){a("#emotion .categories").data("category",b),this.showFacePage(0),this.showPages()},showFacePage:function(b){var c,i,j,d="",f=this.options.rows,g=a("#emotion .categories").data("category"),h=this.emotions[g];for(b=b||0,i=b*f,j=h.length;j>i&&(b+1)*f>i;++i)c=h[i],d+='<li class="item"><a href="#" class="face"><img class="sina-emotion" src="'+c.icon+'" alt="'+c.phrase+'" /></a></li>';a("#emotion .faces").html(d)},showPages:function(){var g,h,b="",c=this.options.rows,d=a("#emotion .categories").data("category"),e=this.emotions[d],f=e.length;if(f>c){for(g=0,h=Math.ceil(f/c);h>g;++g)b+='<li class="item"><a href="#" class="page'+(0==g?" current":"")+'">'+(g+1)+"</a></li>";a("#emotion .pages").html(b).show()}else a("#emotion .pages").hide()}},Object.create||(Object.create=function(){function a(){}return function(b){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e,f,g,h,i;if(null==this)throw new TypeError(" this is null or not defined");if(f=Object(this),g=f.length>>>0,"function"!=typeof a)throw new TypeError(a+" is not a function");for(b&&(c=b),d=new Array(g),e=0;g>e;)e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++;return d}),k=Object.create(j),a.fn.emotion=function(b){return this.each(function(){var c,d;b=b||function(){return a(this).parents(".textarea-wrapper").first().find(".textarea").eq(0)},c=a(this).last(),d=c.offset(),k.$target="function"==typeof b?b.call(c):a(b),0==a("#emotion").length&&k.loadEmotions(function(){k.showCategory(k.defCategory),k.showCatPage(0)}),a("#emotion").css({top:d.top+c.outerHeight()+5,left:d.left}).show()})},l=function(b,c,d){function l(){f.onload=null}function m(){var b,k;try{b=f.contentWindow.location.href}catch(l){k=l}return k||!b?(setTimeout(function(){f.src=i+"#2"},500),void 0):(h===!1?(h=!0,o(),a.each(c,function(a,b){"null"!=b&&p(a,b)}),window.postMessage&&d&&(e=null,e=function(b){a(window).unbind("message",e),f.parentNode.removeChild(f),d(b.originalEvent.data)},a(window).bind("message",e)),g.submit()):(j&&clearTimeout(j),f.onload=null,f.removeEventListener?f.removeEventListener("load",m,!1):f.detachEvent&&f.detachEvent("onload",m),!window.postMessage&&d&&(n(),f.parentNode.removeChild(f))),void 0)}function n(){try{var a=f.contentWindow.name;null!=a&&d(a)}catch(b){}}function o(){var a=f.contentWindow.document;g=a.createElement("form"),g.method="POST",g.action=b,a.body.appendChild(g)}function p(a,b){var c=document.createElement("input");c.type="hidden",c.name=a,c.value=b,g.appendChild(c)}function q(){f=document.createElement("iframe"),f.style.width="0",f.style.height="0",f.src=i+"#1",f.addEventListener?f.addEventListener("load",m,!1):f.attachEvent?f.attachEvent("onload",m):f.onload=m,document.body.appendChild(f)}var e,f,g,h=!1,i="blank.html",j=setTimeout(l,5e3);q()},a.pt=a.pureToolTips=function(c){function u(){var b,c;return d.target?(i.length||(i=a('<div class="pt pt-down"><div class="cont"></div><b class="out"></b><b class="in"></b></div>').appendTo(document.body)),b=i.find(".cont"),d.ptstylename?b.removeClass(d.ptstylename).addClass(d.ptstylename):b.removeClass(b.attr("class")).addClass("cont"),g=i.outerWidth(),h=i.outerHeight(),c=a(window).height()-k-n+a(document).scrollTop(),c<d.height&&(o="t",s=r[o]||r.t),i.removeClass().addClass("pt "+(q?s:"")).find(".cont").html(d.content).css({width:d.width,height:d.height}),e=i.find(".out").toggle(q),f=i.find(".in").toggle(q),q&&w(),i.css(v()).show(),d.leaveClose&&y(),d.autoClose&&x(d.time),i):null}function v(){var a=q?parseInt(e.css("border-top-width"),10):3,b=q?parseInt(e.css("border-right-width"),10):3,c={};switch(p){case"c":break;case"t":c.top=k;break;case"b":c.top=k+n-d.height;break;case"l":c.left=d.login?l+20:l-10;break;case"r":c.left=l+m-g}switch(o){case"t":c.top=d.login?0:k-d.height-b-(n+b)/2;break;case"b":c.top=k+n+b;break;case"l":c.left=l-g-a;break;case"r":c.left=l+m+a}return c.top||(c.top=k+n/2-d.height/2),c.left||(c.left=l+m/2-g/2),c}function w(){function i(){"l"===p&&m/2>c&&m/2<d.width-c?a.left=m/2-c/2:"r"===p&&m/2>c&&m/2<d.width-c&&(a.left=g-m/2-c/2)}var a,b,c,h="auto";switch(o){case"t":c=parseInt(e.css("border-top-width"),10),a={bottom:-c,left:g/2-c,top:h,right:h},i(),b={top:h,left:a.left+1,bottom:a.bottom+1,right:h};break;case"b":c=parseInt(e.css("border-bottom-width"),10),a={top:-c,left:g/2-c,right:h,bottom:h},i(),b={top:a.top+1,left:a.left+1,bottom:h,right:h}}e.css(a),f.css(b)}function x(){window.ptt&&clearTimeout(ptt),window.pta&&clearTimeout(pta),window.pta=setInterval(function(){!d.autoClose||b||t||(i.hide(),a.isFunction(d.close)&&d.close())},d.time)}function y(){i.unbind("mouseleave").mouseleave(function(){t=!1,i.hide(),a.isFunction(d.close)&&d.close()}).unbind("mouseenter").mouseenter(function(){t=!0,window.ptt&&clearTimeout(ptt)})}var e,f,g,h,d=a.extend({target:null,position:"t",align:"l",arrow:!0,content:"",width:200,height:100,autoClose:!0,time:500,leaveClose:!0,close:null,login:!1,ptstylename:null},c||{}),i=a(".pt"),j=a(d.target),k=j.offset().top,l=j.offset().left,m=j.outerWidth(),n=j.outerHeight(),o=d.position,p=d.align,q=d.arrow,r={b:"pt-up",t:"pt-down",r:"pt-left",l:"pt-right"},s=r[o]||r.t,t=!1;return u()},a.fn.pt=a.fn.pureToolTips=function(b){var c=a.extend({leaveClose:!0},b||{});return this.each(function(){a(this).mouseenter(function(){window.ptt&&clearTimeout(ptt),window.pta&&clearTimeout(pta),c.target=this,a.pt(c)}).mouseleave(function(){window.ptt=setTimeout(function(){a(".pt").hide(),a.isFunction(c.close)&&c.close()},500)})})},a.ajax({url:"",success:function(){a(document).ready(function(){var c="127.0.0.1";a("#comments-container").comments({profilePictureURL:"http://ds.cdncache.org/avatar-50/326/67728.jpg",roundProfilePictures:!0,getCommentsNum:function(b,d){a.getJSON("http://"+c+"/comment/count.json?callback=?",{doc_id:b},function(a){"0"==a.code&&d(a)})},getCommentsByPage:function(b,d,e,f){var h="0";h=""==e||"newest"==e?"0":"oldest"==e?"1":"2",d+=1,a.getJSON("http://"+c+"/comment/list.json?callback=?",{orderBy:h,pageNo:d,doc_id:b},function(a){void 0==a.closed&&f(a)})},postComment:function(b,d,e){l("http://"+c+"/comment/create.json?postback=postdone",b,function(c){var f,g,h;if(""==c||null==c){if(i)for(f=0;f<localStorage.length;f++)g=localStorage.key(f),0==g.indexOf("_cmt.")&&localStorage.removeItem(g);return a("#comments-container").data("comments").refreshComments(),void 0}h=JSON.parse(c),"0"==h.code?(c=a.extend(b,h.result),d(c)):"2"==h.code?alert("已被禁言"):e(c)})},deleteComment:function(b,d){a.getJSON("http://"+c+"/comment/del.json?callback=?&id="+b.id,function(a){"0"==a.code&&d(a)})},upvoteComment:function(b,d,e){a.getJSON("http://"+c+"/comment/vote.json?callback=?&type=0&action="+(b.user_has_upvoted?1:0)+"&id="+b.id,function(a){"0"==a.code?d(a):e(a)})},downvoteComment:function(b,d,e){a.getJSON("http://"+c+"/comment/vote.json?callback=?&type=1&action="+(b.user_has_downvoted?1:0)+"&id="+b.id,function(a){"0"==a.code?d(a):e(a)})},jubaoComment:function(b,d){a.getJSON("http://"+c+"/comment/jubao.json?callback=?&id="+b.id,function(a){"0"==a.code&&d(a)})},watchDone:function(b,d,e,f){a.getJSON("http://"+c+"/user/watch?callback=?&id="+d+"&type="+b,function(a){"0"==a.code?e(a):f(a)})},isUserSigned:function(){var c,a="GCU",b=null,d=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(c=document.cookie.match(d))&&(b=unescape(c[2])),null!=b?!0:!1}})})}})}(jQuery);
